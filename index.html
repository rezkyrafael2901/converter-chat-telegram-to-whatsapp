<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Telegram → WhatsApp Converter</title>
<style>
  body{
    font-family: Arial, sans-serif; 
    max-width:780px; 
    margin:36px auto; 
    padding:0 16px;
  }
  .card{
    border:1px solid #e0e0e0; 
    padding:20px; 
    border-radius:10px; 
    box-shadow:0 2px 6px rgba(0,0,0,.04)
  }
  .row{margin:12px 0}
  #loader{display:none}
  #status{
    white-space:pre-wrap; 
    margin-top:10px; 
    color:#333
  }
  button{
    padding:9px 16px; 
    border:none; 
    background:#007bff; 
    color:white; 
    border-radius:5px; 
    cursor:pointer; 
    margin-right:8px;
  }
  button:hover{background:#005fcc}
  input[type=text]{
    padding:6px 10px; 
    width:350px
  }
  input[type=file]{padding:6px}
  label.small{
    font-size:13px; 
    color:#555
  }
</style>
</head>
<body>

  <h2>Telegram HTML → WhatsApp TXT Converter</h2>

  <div class="card">

    <!-- FILE INPUT -->
    <div class="row">
      <input id="file" type="file" accept=".html"/>
    </div>

    <!-- NAME INPUT -->
    <div class="row">
      <label class="small">Nama file hasil (tanpa .txt):</label><br/>
      <input type="text" id="filename" value="Chat Whatsapp dengan " />
    </div>

    <!-- BUTTONS -->
    <div class="row">
      <button id="btn">Convert & Download TXT</button>
      <button id="btnZip">Convert & Encrypt ZIP</button>
      <span id="loader">⏳ Processing...</span>
    </div>

    <!-- PASSWORD -->
    <div class="row">
      <label class="small">ZIP Password (opsional):</label><br/>
      <input type="text" id="zipPass" placeholder="Ketik password jika ingin encrypt" />
    </div>

    <!-- STATUS AREA -->
    <div id="status"></div>

  </div>

<script>
const fileInput = document.getElementById('file');
const btn = document.getElementById('btn');
const btnZip = document.getElementById('btnZip');
const loader = document.getElementById('loader');
const status = document.getElementById('status');

function setStatus(msg){
  status.textContent = msg;
}

/* ============================
   DOWNLOAD TXT 
============================ */
btn.addEventListener("click", async () => {
  setStatus("");

  const file = fileInput.files[0];
  if(!file){
    setStatus("Harap pilih file HTML Telegram (.html).");
    return;
  }

  let filenameBase = document.getElementById("filename").value.trim();
  const finalName = filenameBase ? (filenameBase + ".txt") : "converted_whatsapp.txt";

  loader.style.display = "inline";
  btn.disabled = true;

  try {
    let fd = new FormData();
    fd.append("file", file);
    fd.append("filename", finalName);

    const resp = await fetch("/convert", { method:"POST", body:fd });

    if(!resp.ok){
      const txt = await resp.text();
      setStatus("Error: " + txt);
    } else {
      const blob = await resp.blob();
      const url = URL.createObjectURL(blob);

      const a = document.createElement("a");
      a.href = url;
      a.download = finalName;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);

      setStatus("Berhasil! File TXT berhasil diunduh: " + finalName);
    }

  } catch(e){
    setStatus("Error: " + e.toString());
    console.error(e);

  } finally {
    loader.style.display = "none";
    btn.disabled = false;
  }
});

/* ============================
   DOWNLOAD ZIP 
============================ */
btnZip.addEventListener("click", async () => {
  setStatus("");

  const file = fileInput.files[0];
  if(!file){
    setStatus("Harap pilih file HTML Telegram (.html).");
    return;
  }

  let filenameBase = document.getElementById("filename").value.trim();
  const finalTxtName = filenameBase ? (filenameBase + ".txt") : "converted_whatsapp.txt";
  const finalZipName = (filenameBase ? filenameBase : "converted_chat") + ".zip";

  const password = document.getElementById("zipPass").value || "";

  loader.style.display = "inline";
  btnZip.disabled = true;

  try {
    let fd = new FormData();
    fd.append("file", file);
    fd.append("password", password);
    fd.append("filename", finalTxtName);

    const resp = await fetch("/convert_zip", { method:"POST", body:fd });

    if(!resp.ok){
      const txt = await resp.text();
      setStatus("Error: " + txt);
    } else {
      const blob = await resp.blob();
      const url = URL.createObjectURL(blob);

      const a = document.createElement("a");
      a.href = url;
      a.download = finalZipName;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);

      setStatus("ZIP berhasil dibuat & diunduh: " + finalZipName);
    }

  } catch(e){
    setStatus("Error: " + e.toString());
    console.error(e);

  } finally {
    loader.style.display = "none";
    btnZip.disabled = false;
  }
});
</script>

</body>
</html>
